<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Карта громад Черкащини</title>
    <style>
        body { margin: 0; background: #333; display: flex; justify-content: center; padding: 20px; font-family: sans-serif; }
        
        /* Важливо: Контейнер має бути рівно 900x736 */
        .map-container { 
            position: relative; 
            width: 900px; 
            height: 736px; 
            background: white;
            overflow: hidden;
        }

        #base-map { width: 900px; height: 736px; display: block; }
        #svg-layer { position: absolute; top: 0; left: 0; width: 900px; height: 736px; z-index: 10; }

        .badge { cursor: pointer; }
        .badge circle { fill: #cc0000; stroke: white; stroke-width: 2; }
        .badge text { fill: white; font-size: 11px; font-weight: bold; pointer-events: none; text-anchor: middle; dominant-baseline: middle; }

        #popup {
            position: absolute; display: none; background: white; border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); padding: 15px; z-index: 100;
            min-width: 250px; border-left: 5px solid #cc0000;
        }
    </style>
</head>
<body>

<div class="map-container" id="container">
    <img src="map.jpg" id="base-map">
    <svg id="svg-layer" viewBox="0 0 900 736"></svg>
    
    <div id="popup">
        <div id="pop-name" style="font-weight:bold; color:#8b0000; margin-bottom:5px;"></div>
        <div id="pop-content" style="font-size:13px; color:#333;"></div>
    </div>
</div>

<script src="hromadas-data.js"></script>
<script src="collectives.js"></script>

<script>
    const svg = document.getElementById('svg-layer');
    const popup = document.getElementById('popup');

    // КОРЕКТОР КООРДИНАТ: Клікніть на мапу, щоб отримати X та Y для hromadas-data.js
    svg.addEventListener('click', function(e) {
        const rect = svg.getBoundingClientRect();
        const x = Math.round(e.clientX - rect.left);
        const y = Math.round(e.clientY - rect.top);
        console.log(`Координати для громади: { "name": "НАЗВА", "x": ${x}, "y": ${y} },`);
    });

    function init() {
        svg.innerHTML = '';
        hromadasGeoJSON.features.forEach(h => {
            // Пошук тільки за коротким словом (напр. "Драбівська")
            const searchName = h.name.split(' ')[0].toLowerCase();
            let count = 0;
            let list = [];

            for (let genre in collectivesData) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = collectivesData[genre];
                tempDiv.querySelectorAll('li').forEach(li => {
                    if (li.innerText.toLowerCase().includes(searchName)) {
                        count++;
                        list.push(li.innerText);
                    }
                });
            }

            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute("class", "badge");
            g.innerHTML = `<circle cx="${h.x}" cy="${h.y}" r="12" /><text x="${h.x}" y="${h.y}">${count}</text>`;

            g.onclick = (e) => {
                e.stopPropagation();
                document.getElementById('pop-name').innerText = h.name;
                document.getElementById('pop-content').innerHTML = list.length > 0 ? list.join('<br><br>') : "Дані відсутні";
                popup.style.display = 'block';
                popup.style.left = (h.x > 450 ? h.x - 270 : h.x + 20) + 'px';
                popup.style.top = (h.y - 30) + 'px';
            };
            svg.appendChild(g);
        });
    }

    document.addEventListener('click', (e) => { if(e.target.tagName !== 'g') popup.style.display = 'none'; });
    window.onload = init;
</script>
</body>
</html>
