<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É–ª—å—Ç—É—Ä–Ω–∞ –ö–∞—Ä—Ç–∞ –ß–µ—Ä–∫–∞—â–∏–Ω–∏</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f4f4; display: flex; justify-content: center; padding: 20px; }
        
        .map-wrapper { 
            position: relative; 
            width: 900px; 
            height: 736px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
            border-radius: 5px; 
            background: #fff;
        }

        #base-map { width: 100%; height: 100%; display: block; }

        /* –°—Ç–∏–ª—å –±–∞–¥–∂—ñ–≤ –∑ —Ü–∏—Ñ—Ä–∞–º–∏ */
        .badge { cursor: pointer; transition: transform 0.2s ease; }
        .badge:hover { transform: scale(1.3); }
        .badge circle { fill: #cc0000; stroke: white; stroke-width: 2; }
        .badge text { fill: white; font-size: 11px; font-weight: bold; font-family: sans-serif; pointer-events: none; }

        /* –í—ñ–∫–æ–Ω—Ü–µ (Popup) */
        #popup {
            position: absolute;
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            padding: 12px;
            z-index: 1000;
            min-width: 230px;
            border: 1px solid #ddd;
        }

        .pop-title { font-weight: bold; color: #8b0000; margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 5px; font-size: 14px; }
        .pop-item { display: flex; align-items: center; padding: 5px 0; font-size: 13px; color: #333; }
        .pop-icon { margin-right: 10px; font-size: 16px; min-width: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="map-wrapper">
    <img src="map.jpg" id="base-map" alt="–ö–∞—Ä—Ç–∞ –ß–µ—Ä–∫–∞—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ">
    
    <svg id="svg-layer" viewBox="0 0 900 736" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></svg>
    
    <div id="popup">
        <div class="pop-title" id="pop-name">–ù–∞–∑–≤–∞ –≥—Ä–æ–º–∞–¥–∏</div>
        <div id="pop-list"></div>
    </div>
</div>

<script src="hromadas-data.js"></script>
<script src="collectives.js"></script>

<script>
    const svg = document.getElementById('svg-layer');
    const popup = document.getElementById('popup');
    const popName = document.getElementById('pop-name');
    const popList = document.getElementById('pop-list');

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–Ω–∞—á–∫—ñ–≤ –∂–∞–Ω—Ä—ñ–≤
    const genreIcons = {
        "vocal": "üé§",
        "dance": "üíÉ",
        "music": "üéª",
        "theatre": "üé≠",
        "default": "üé≠"
    };

    // –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –º–∞–ª—é–≤–∞–Ω–Ω—è —Ç–æ—á–æ–∫
    function initMap() {
        hromadasGeoJSON.features.forEach(hromada => {
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∫–æ–ª–µ–∫—Ç–∏–≤–∏ –∑ —Ñ–∞–π–ª—É collectives.js –¥–ª—è —Ü—ñ—î—ó –≥—Ä–æ–º–∞–¥–∏
            const localCollectives = typeof allCollectives !== 'undefined' 
                ? allCollectives.filter(c => c.hromada === hromada.name)
                : (hromada.collectives || []);

            const count = localCollectives.length;

            // –°—Ç–≤–æ—Ä—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç SVG
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute("class", "badge");

            g.innerHTML = `
                <circle cx="${hromada.x}" cy="${hromada.y}" r="12" />
                <text x="${hromada.x}" y="${hromada.y + 4}" text-anchor="middle">${count}</text>
            `;

            // –ö–ª—ñ–∫ –ø–æ —Ç–æ—á—Ü—ñ
            g.onclick = (e) => {
                e.stopPropagation();
                showPopup(hromada.name, localCollectives, e.pageX, e.pageY);
            };

            svg.appendChild(g);
        });
    }

    function showPopup(name, list, x, y) {
        popName.innerText = name;
        
        if (list.length === 0) {
            popList.innerHTML = "<div class='pop-item'>–î–∞–Ω—ñ –ø—Ä–æ –∫–æ–ª–µ–∫—Ç–∏–≤–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ</div>";
        } else {
            popList.innerHTML = list.map(c => `
                <div class="pop-item">
                    <span class="pop-icon">${genreIcons[c.type] || genreIcons.default}</span>
                    <span>${c.name}</span>
                </div>
            `).join('');
        }

        popup.style.display = 'block';
        
        // –ü–æ–∑–∏—Ü—ñ—é–≤–∞–Ω–Ω—è –≤—ñ–∫–æ–Ω—Ü—è (–∑–º—ñ—â–µ–Ω–Ω—è, —â–æ–± –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—Ç–∏ –∫—É—Ä—Å–æ—Ä)
        popup.style.left = (x - 200) + 'px'; 
        popup.style.top = (y - 120) + 'px';
    }

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –±—É–¥—å-—è–∫–µ —ñ–Ω—à–µ –º—ñ—Å—Ü–µ –∫–∞—Ä—Ç–∏
    document.addEventListener('click', () => {
        popup.style.display = 'none';
    });

    // –ó–∞–ø—É—Å–∫ –∫–∞—Ä—Ç–∏
    window.onload = initMap;
</script>

</body>
</html>
