<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –∫–æ–ª–µ–∫—Ç–∏–≤—ñ–≤ –ß–µ—Ä–∫–∞—â–∏–Ω–∏</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        
        /* –§–æ–Ω –∑ –≤–∞—à–∏–º –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º */
        #map { 
            height: 100vh; 
            width: 100%; 
            background-color: #f4f4f4;
        }

        /* –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è */
        .map-controls {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .map-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
            transition: all 0.3s;
        }

        .active-btn { background: #e67e22; color: white; }
        .inactive-btn { background: #ecf0f1; color: #2c3e50; }

        /* –°—Ç–∏–ª—å –º–∞—Ä–∫–µ—Ä–∞ –∑ —Ü–∏—Ñ—Ä–æ—é */
        .count-icon {
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            font-size: 14px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* –°—Ç–∏–ª—å –ø–æ–ø–∞–ø–∞ (—Ç–∞–±–ª–∏—á–∫–∏) */
        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 10px;
            padding: 5px;
        }
        
        .collectives-scroll-container {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .collectives-scroll-container::-webkit-scrollbar {
            width: 6px;
        }
        .collectives-scroll-container::-webkit-scrollbar-thumb {
            background: #bdc3c7;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div class="map-controls">
        <button id="btn-col" class="map-btn active-btn" onclick="switchMode('collectives')">–ö–æ–ª–µ–∫—Ç–∏–≤–∏</button>
        <button id="btn-bat" class="map-btn inactive-btn" onclick="switchMode('battle')">–ë–∏—Ç–≤–∞ –≤–ø–æ–¥–æ–±–∞–π–∫—ñ–≤</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="hromadas-data.js"></script>
    <script src="collectives-list.js"></script>

    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞–ø–∏
        const map = L.map('map', {
            zoomSnap: 0.1
        }).setView([49.2, 31.5], 8.5);

        // –î–æ–¥–∞—î–º–æ –≤–∞—à–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è map.jpg —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π —à–∞—Ä
        const imageBounds = [[48.2, 29.5], [50.3, 33.5]]; // –ú–µ–∂—ñ –æ–±–ª–∞—Å—Ç—ñ (–ø—ñ–¥–∫–æ—Ä–∏–≥—É–π—Ç–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
        L.imageOverlay('map.jpg', imageBounds, { opacity: 1 }).addTo(map);

        let currentMode = 'collectives';
        let markersLayer = L.layerGroup().addTo(map);

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ—á–æ–∫ –∑ —Ü–∏—Ñ—Ä–∞–º–∏
        function renderMarkers() {
            markersLayer.clearLayers();

            hromadasData.features.forEach(feature => {
                const name = feature.properties.name.trim().toLowerCase();
                const coords = feature.geometry.coordinates;
                // –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∑ –Ω–∞—à–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É
                const list = collectivesList[name] || [];
                const count = list.length;

                // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–∫–æ–Ω–∫—É –∑ —Ü–∏—Ñ—Ä–æ—é
                const icon = L.divIcon({
                    className: 'count-icon',
                    html: count,
                    iconSize: [30, 30]
                });

                // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Ä–∫–µ—Ä (—Ç–æ—á–∫—É)
                const marker = L.marker([coords[1], coords[0]], { icon: icon });

                // –§–æ—Ä–º—É—î–º–æ –≤–º—ñ—Å—Ç —Ç–∞–±–ª–∏—á–∫–∏ (–ø–æ–ø–∞–ø–∞)
                let popupContent = `<div style="min-width:280px;">
                    <h3 style="margin:0 0 10px 0; color:#2c3e50; border-bottom:2px solid #3498db;">${feature.properties.name}</h3>`;

                if (currentMode === 'collectives') {
                    popupContent += `<p><b>–í—Å—å–æ–≥–æ –∫–æ–ª–µ–∫—Ç–∏–≤—ñ–≤: ${count}</b></p>
                        <div class="collectives-scroll-container">
                            <ul style="padding:0; list-style:none; font-size:13px;">
                                ${list.map(item => `<li style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">${item}</li>`).join('')}
                            </ul>
                        </div>`;
                } else {
                    popupContent += `<div style="text-align:center; padding:10px;">
                        <p style="font-size:18px;">üî• –†–µ–π—Ç–∏–Ω–≥: <b>#1</b></p>
                        <p>–í–ø–æ–¥–æ–±–∞–π–æ–∫: <b>1,245</b></p>
                        <button style="background:#e74c3c; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">–ì–æ–ª–æ—Å—É–≤–∞—Ç–∏ ‚ù§Ô∏è</button>
                    </div>`;
                }

                popupContent += `</div>`;
                marker.bindPopup(popupContent, { className: 'custom-popup' });
                markersLayer.addLayer(marker);
            });
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞—á —Ä–µ–∂–∏–º—ñ–≤
        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('btn-col').className = mode === 'collectives' ? 'map-btn active-btn' : 'map-btn inactive-btn';
            document.getElementById('btn-bat').className = mode === 'battle' ? 'map-btn active-btn' : 'map-btn inactive-btn';
            renderMarkers();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = renderMarkers;

    </script>
</body>
</html>
